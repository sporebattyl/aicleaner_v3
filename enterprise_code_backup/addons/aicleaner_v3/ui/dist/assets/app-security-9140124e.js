var e=(e,s,a)=>new Promise((l,n)=>{var t=e=>{try{r(a.next(e))}catch(s){n(s)}},i=e=>{try{r(a.throw(e))}catch(s){n(s)}},r=e=>e.done?l(e.value):Promise.resolve(e.value).then(t,i);r((a=a.apply(e,s)).next())});import{r as s,j as a}from"./vendor-react-028964e9.js";import{c as l,a as n,n as t,o as i,f as r,F as c,w as d,e as m}from"./vendor-icons-3eef39ee.js";import{A as o}from"./app-services-39021a89.js";import{S as x,A as u,b as j,R as h,C as v,a as p,B as N,L as y,M as g,F as f}from"./vendor-ui-95f0caeb.js";import"./vendor-export-9f6dbaf1.js";import"./vendor-utils-818bbafa.js";import"./app-analytics-3785476f.js";import"./vendor-charts-07629b84.js";import"./vendor-date-16f33ebf.js";import"./vendor-misc-6615fe3f.js";const b=()=>{var b,w;const[S,k]=s.useState(null),[_,T]=s.useState(!0),[C,L]=s.useState(null),[B,E]=s.useState(!1),[F,H]=s.useState(""),[I,V]=s.useState(null),[A,R]=s.useState(!1);s.useEffect(()=>{q();const e=setInterval(q,3e4);return()=>clearInterval(e)},[]);const q=()=>e(void 0,null,function*(){try{T(!0);const e=yield o.get("/api/security");k(e),L(null)}catch(e){L("Failed to load security status")}finally{T(!1)}});return _?a.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"200px"},children:a.jsx(x,{animation:"border",role:"status",children:a.jsx("span",{className:"visually-hidden",children:"Loading security status..."})})}):C?a.jsxs(u,{variant:"danger",children:[a.jsx(l,{className:"me-2"}),C,a.jsx(j,{variant:"outline-danger",size:"sm",className:"ms-2",onClick:q,children:"Retry"})]}):a.jsxs("div",{className:"security-dashboard",children:[a.jsx(h,{className:"mb-4",children:a.jsxs(v,{children:[a.jsxs("h4",{children:[a.jsx(n,{className:"me-2"}),"Security Dashboard"]}),a.jsx("p",{className:"text-muted",children:"Monitor and manage AICleaner v3 security status"})]})}),a.jsxs(h,{className:"mb-4",children:[a.jsx(v,{md:8,children:a.jsxs(p,{children:[a.jsx(p.Header,{children:a.jsxs("h5",{className:"mb-0",children:[(e=>{switch(e){case"high":return a.jsx(n,{className:"text-success"});case"medium":return a.jsx(l,{className:"text-warning"});case"low":return a.jsx(i,{className:"text-danger"});default:return a.jsx(n,{className:"text-secondary"})}})(null==S?void 0:S.security_level),a.jsx("span",{className:"ms-2",children:"Security Overview"}),a.jsx(N,{bg:(e=>{switch(e){case"high":return"success";case"medium":return"warning";case"low":return"danger";default:return"secondary"}})(null==S?void 0:S.security_level),className:"ms-2",children:(null==(b=null==S?void 0:S.security_level)?void 0:b.toUpperCase())||"UNKNOWN"})]})}),a.jsx(p.Body,{children:a.jsxs(h,{children:[a.jsxs(v,{md:6,children:[a.jsxs("div",{className:"d-flex align-items-center mb-3",children:[(null==S?void 0:S.supervisor_token_valid)?a.jsx(t,{className:"text-success me-2"}):a.jsx(i,{className:"text-danger me-2"}),a.jsx("span",{children:"Supervisor Token"}),a.jsx(N,{bg:(null==S?void 0:S.supervisor_token_valid)?"success":"danger",className:"ms-auto",children:(null==S?void 0:S.supervisor_token_valid)?"Valid":"Invalid"})]}),a.jsxs("div",{className:"d-flex align-items-center mb-3",children:[(null==S?void 0:S.tls_enabled)?a.jsx(r,{className:"text-success me-2"}):a.jsx(c,{className:"text-warning me-2"}),a.jsx("span",{children:"MQTT Encryption"}),a.jsx(N,{bg:(null==S?void 0:S.tls_enabled)?"success":"warning",className:"ms-auto",children:(null==S?void 0:S.tls_enabled)?"TLS Enabled":"Unencrypted"})]}),a.jsxs("div",{className:"d-flex align-items-center",children:[(null==S?void 0:S.mqtt_secured)?a.jsx(t,{className:"text-success me-2"}):a.jsx(l,{className:"text-warning me-2"}),a.jsx("span",{children:"MQTT Security"}),a.jsx(N,{bg:(null==S?void 0:S.mqtt_secured)?"success":"warning",className:"ms-auto",children:(null==S?void 0:S.mqtt_secured)?"Secured":"Needs Review"})]})]}),a.jsx(v,{md:6,children:a.jsxs("div",{className:"text-center",children:[a.jsx("h6",{children:"Threats Detected"}),a.jsx("div",{className:"display-6 text-primary",children:(null==S?void 0:S.threats_detected)||0}),a.jsxs("small",{className:"text-muted",children:["Last check: ",new Date(null==S?void 0:S.last_security_check).toLocaleString()]})]})})]})})]})}),a.jsx(v,{md:4,children:a.jsxs(p,{children:[a.jsx(p.Header,{children:a.jsxs("h6",{className:"mb-0",children:[a.jsx(d,{className:"me-2"}),"Security Actions"]})}),a.jsx(p.Body,{children:a.jsxs("div",{className:"d-grid gap-2",children:[a.jsxs(j,{variant:"outline-primary",onClick:()=>E(!0),children:[a.jsx(d,{className:"me-2"}),"Validate Token"]}),a.jsxs(j,{variant:"outline-secondary",onClick:q,children:[a.jsx(n,{className:"me-2"}),"Refresh Status"]})]})})]})})]}),a.jsx(h,{children:a.jsx(v,{children:a.jsxs(p,{children:[a.jsx(p.Header,{children:a.jsxs("h6",{className:"mb-0",children:[a.jsx(m,{className:"me-2"}),"Recent Security Events"]})}),a.jsx(p.Body,{children:(null==(w=null==S?void 0:S.security_events)?void 0:w.length)>0?a.jsx(y,{variant:"flush",children:S.security_events.slice(0,10).map((e,s)=>a.jsx(y.Item,{className:"px-0",children:a.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[a.jsxs("div",{children:[a.jsx(N,{bg:"error"===e.level?"danger":"warning"===e.level?"warning":"info",className:"me-2",children:e.type}),a.jsx("span",{children:e.message})]}),a.jsx("small",{className:"text-muted",children:new Date(e.timestamp).toLocaleString()})]})},s))}):a.jsxs("div",{className:"text-center text-muted py-3",children:[a.jsx(m,{className:"mb-2",style:{fontSize:"2rem",opacity:.3}}),a.jsx("p",{children:"No security events recorded"})]})})]})})}),a.jsxs(g,{show:B,onHide:()=>E(!1),children:[a.jsx(g.Header,{closeButton:!0,children:a.jsxs(g.Title,{children:[a.jsx(d,{className:"me-2"}),"Validate Supervisor Token"]})}),a.jsx(g.Body,{children:a.jsx(f,{children:a.jsxs(f.Group,{className:"mb-3",children:[a.jsx(f.Label,{children:"Supervisor Token"}),a.jsx(f.Control,{type:"password",placeholder:"Enter supervisor token...",value:F,onChange:e=>H(e.target.value),isValid:!0===(null==I?void 0:I.valid),isInvalid:!1===(null==I?void 0:I.valid)}),a.jsx(f.Text,{className:"text-muted",children:"Enter your Home Assistant supervisor token for validation"}),I&&a.jsxs("div",{className:"mt-2 "+(I.valid?"text-success":"text-danger"),children:[I.valid?a.jsx(t,{className:"me-1"}):a.jsx(i,{className:"me-1"}),I.message]})]})})}),a.jsxs(g.Footer,{children:[a.jsx(j,{variant:"secondary",onClick:()=>E(!1),children:"Cancel"}),a.jsx(j,{variant:"primary",onClick:()=>e(void 0,null,function*(){if(F.trim())try{R(!0);const e=yield o.post("/api/security/validate-token",{token:F});V(e),setTimeout(q,1e3)}catch(e){V({valid:!1,message:"Token validation failed"})}finally{R(!1)}else V({valid:!1,message:"Token is required"})}),disabled:A||!F.trim(),children:A?a.jsxs(a.Fragment,{children:[a.jsx(x,{size:"sm",className:"me-2"}),"Validating..."]}):a.jsxs(a.Fragment,{children:[a.jsx(d,{className:"me-2"}),"Validate Token"]})})]})]})]})};export{b as SecurityDashboard,b as default};
